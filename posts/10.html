---
title: "Latest 5 NYT top stories on Technology, Arts and Movies"
date: 2020-10-30
---
{% set html %}
<div id="app">
  <span id="placeholder">Loading latest stories...</span>
</div>
{% endset %}

<div class="htmlBox">
  {{ html | safe }}
</div>

{% highlight "html" %}
{{ html | safe }}
{% endhighlight %}

{% set js %}
<script async>

  // Variables
  let elem = document.querySelector('#app');

  // Methods
  // ---Get the arrays and call updateDOM
  function callNYT(section) {
    let sectionKey = section.toLowerCase();
    fetch(`https://api.nytimes.com/svc/topstories/v2/${sectionKey}.json?api-key=V4DAxXaiDzvGkumnpxfO4LpmCd7dM9om`).then(function (response) {
      if (response.ok) {
        return response.json();
      } else {
        return Promise.reject(response);
      }
    })
      .then(array => updateDOM(array.results, section))
      .catch(function (error) {
        console.warn("oh no something went wrong", error);
        let placeholder = document.querySelector("#placeholder");
        if (placeholder) placeholder.remove();
        elem.innerHTML += `<h2>${section}</h2><p>Sorry, something went wrong gathering these stories.</p>`;
      })
  };

  // ---Helper function to insert the newest 5 as list items in the DOM
  function updateDOM(storiesArray, section) {
    let top5 = storiesArray.slice(0, 5);
    let stories = top5.map(function (story) {
      return `<li><a href="${story.short_url}">${story.title}</a></li>`;
    }).join('');
    let placeholder = document.querySelector("#placeholder");
    if (placeholder) placeholder.remove();
    elem.innerHTML += `<h2>${section}</h2><ul>${stories}</ul>`;
  }

  // Inits
  callNYT('Technology');
  callNYT('Arts');
  callNYT('Movies');

</script>
{% endset %}

{% highlight "html" %}
{{ js | safe }}
{% endhighlight %}

<div class="htmlBox">

</div>

{{ js | safe }}