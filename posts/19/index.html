<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latest 5 NYT top stories on Technology, Arts and Movies</title>
    <meta name="description" content="Exercises on Vanilla JS Academy 2020">
    <link rel="stylesheet" href="/vanillajsacademy/css/index.css">
    <link rel="stylesheet" href="/vanillajsacademy/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/vanillajsacademy/feed/feed.xml" type="application/atom+xml" title="miguelslp - Vanilla JS">
    <link rel="alternate" href="/vanillajsacademy/feed/feed.json" type="application/json" title="miguelslp - Vanilla JS">
  </head>
  <body>
    <header>
      <h1 class="home">
        <a href="/vanillajsacademy/">miguelslp - Vanilla JS</a>
      </h1>
      
    </header>

    <main  class="tmpl-post" >
      <h1>Latest 5 NYT top stories on Technology, Arts and Movies</h1>

<div class="grid">


<div class="htmlBox">
  
<div id="app">
  <span id="placeholder">Loading latest stories...</span>
</div>

</div>

<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Loading latest stories...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>



<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br><br>  <span class="token comment">// Variables</span><br>  <span class="token keyword">let</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> apiKey <span class="token operator">=</span> <span class="token string">'V4DAxXaiDzvGkumnpxfO4LpmCd7dM9om'</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> sections <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'technology'</span><span class="token punctuation">,</span> <span class="token string">'arts'</span><span class="token punctuation">,</span> <span class="token string">'movies'</span><span class="token punctuation">,</span><span class="token string">'nonexisting'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">let</span> numberOfArticles <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Methods</span><br>  <span class="token comment">// ---Get the arrays and call updateDOM</span><br>  <span class="token keyword">function</span> <span class="token function">callNYT</span><span class="token punctuation">(</span><span class="token parameter">section</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.nytimes.com/svc/topstories/v2/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>section<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json?api-key=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>apiKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">array</span> <span class="token operator">=></span> <span class="token function">updateDOM</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Oh no something went wrong"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> placeholder <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#placeholder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>placeholder<span class="token punctuation">)</span> placeholder<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">let</span> errorState <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#errorState'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errorState<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          errorState <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          errorState<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"errorState"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>          errorState<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"Sorry, something went wrong gathering stories on"</span><br>          app<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>errorState<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        errorState<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>        &lt;code> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>section<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/code><br>        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// ---Helper function to insert the newest 5 as list items in the DOM</span><br>  <span class="token keyword">function</span> <span class="token function">updateDOM</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> top5 <span class="token operator">=</span> array<span class="token punctuation">.</span>results<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> numberOfArticles<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> stories <span class="token operator">=</span> top5<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">story</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;article>&lt;a href="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>story<span class="token punctuation">.</span>short_url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>story<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/a>&lt;/article></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">let</span> placeholder <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#placeholder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>placeholder<span class="token punctuation">)</span> placeholder<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    elem<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>    &lt;h2></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>array<span class="token punctuation">.</span>section<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h2><br>    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stories<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Inits</span><br>  <span class="token comment">// ---Calling also 'nonexisting' as an error on purpose</span><br>  sections<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">section</span> <span class="token operator">=></span> <span class="token function">callNYT</span><span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>

<div class="htmlBox">

</div>


<script async>

  // Variables
  let elem = document.querySelector('#app');
  let apiKey = 'V4DAxXaiDzvGkumnpxfO4LpmCd7dM9om';
  let sections = ['technology', 'arts', 'movies','nonexisting'];
  let numberOfArticles = 5;

  // Methods
  // ---Get the arrays and call updateDOM
  function callNYT(section) {
    fetch(`https://api.nytimes.com/svc/topstories/v2/${section}.json?api-key=${apiKey}`).then(function (response) {
      if (response.ok) {
        return response.json();
      } else {
        return Promise.reject(response);
      }
    })
      .then(array => updateDOM(array))
      .catch(function (error) {
        console.warn("Oh no something went wrong", error);
        let placeholder = document.querySelector("#placeholder");
        if (placeholder) placeholder.remove();
        let errorState = document.querySelector('#errorState');
        if (!errorState) {
          errorState = document.createElement('p');
          errorState.setAttribute("id", "errorState");
          errorState.textContent = "Sorry, something went wrong gathering stories on"
          app.after(errorState);
        }
        errorState.innerHTML += `
        <code> ${section}</code>
        `;
      })
  };

  // ---Helper function to insert the newest 5 as list items in the DOM
  function updateDOM(array) {
    let top5 = array.results.slice(0, numberOfArticles);
    let stories = top5.map(function (story) {
      return `<article><a href="${story.short_url}">${story.title}</a></article>`;
    }).join('');
    let placeholder = document.querySelector("#placeholder");
    if (placeholder) placeholder.remove();
    elem.innerHTML += `
    <h2>${array.section}</h2>
    ${stories}
    `;
  }

  // Inits
  // ---Calling also 'nonexisting' as an error on purpose
  sections.forEach(section => callNYT(section));

</script>

</div>

    </main>

    <footer>
      ©
      Miguel Pinto
      2021
    </footer>

    <!-- Current page: /vanillajsacademy/posts/19/ -->

    
    
  </body>
</html>